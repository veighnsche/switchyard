{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "SwitchyardAuditEvent",
  "type": "object",
  "required": ["ts","plan_id","stage","decision","path"],
  "properties": {
    "ts": {"type":"string","format":"date-time"},
    "plan_id": {"type":"string"},
    "schema_version": {"type":"integer","enum":[1]},
    "action_id": {"type":"string"},
    "stage": {"enum":["plan","preflight","apply.attempt","apply.result","rollback","rollback.summary","prune.result"]},
    "decision": {"enum":["success","failure","warn"]},
    "severity": {"enum":["info","warn","error"]},
    "degraded": {"type":["boolean","null"]},
    "path": {"type":"string"},
    "current_kind": {"type":"string"},
    "planned_kind": {"type":"string"},
    "hash_alg": {"type":"string","enum":["sha256"]},
    "before_hash": {"type":"string"},
    "after_hash": {"type":"string"},
    "attestation": {
      "type":"object",
      "properties": {
        "sig_alg": {"type":"string","enum":["ed25519"]},
        "signature": {"type":"string"},
        "bundle_hash": {"type":"string"},
        "public_key_id": {"type":"string"}
      }
    },
    "provenance": {
      "type":"object",
      "properties": {
        "origin": {"enum":["repo","aur","manual"]},
        "helper": {"type":"string"},
        "uid": {"type":"integer"},
        "gid": {"type":"integer"},
        "pkg": {"type":"string"},
        "env_sanitized": {"type":"boolean"}
      }
    },
    "preservation": {
      "type":"object",
      "properties": {
        "owner": {"type":"boolean"},
        "mode": {"type":"boolean"},
        "timestamps": {"type":"boolean"},
        "xattrs": {"type":"boolean"},
        "acls": {"type":"boolean"},
        "caps": {"type":"boolean"}
      }
    },
    "preservation_supported": {"type":["boolean","null"]},
    "exit_code": {"type":["integer","null"]},
    "duration_ms": {"type":["integer","null"]},
    "lock_wait_ms": {"type":["integer","null"]},
    "error_detail": {"type": ["string", "null"]},
    "summary_error_ids": {"type": ["array", "null"], "items": {"type": "string"}}
  }
}
